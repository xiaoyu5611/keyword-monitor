<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…³é”®è¯ç›‘æ§ç®¡ç†åå°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #ffffff;
            color: #333;
        }

        /* ç™»å½•ç•Œé¢ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #ffffff;
        }

        .login-box {
            background: #f8f9fa;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            border: 1px solid #e0e0e0;
        }

        .login-title {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .login-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .login-btn:hover {
            background: #45a049;
        }

        /* ç®¡ç†åå°å¸ƒå±€ */
        .admin-container {
            display: none;
            height: 100vh;
            overflow: hidden;
        }

        .admin-layout {
            display: flex;
            height: 100%;
        }

        /* ä¾§è¾¹å¯¼èˆªæ  */
        .sidebar {
            width: 250px;
            background: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 20px;
            background: #34495e;
            border-bottom: 1px solid #1a252f;
        }

        .sidebar-header h2 {
            font-size: 18px;
            display: flex;
            align-items: center;
        }

        .sidebar-menu {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }

        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            color: #ecf0f1;
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background: #34495e;
        }

        .menu-item.active {
            background: #34495e;
            border-left-color: #4CAF50;
            color: #4CAF50;
        }

        .menu-item-icon {
            margin-right: 10px;
            font-size: 18px;
        }

        .sidebar-footer {
            padding: 15px 20px;
            border-top: 1px solid #1a252f;
        }

        .logout-btn {
            width: 100%;
            padding: 10px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #ffffff;
        }

        .content-header {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content-header h1 {
            font-size: 24px;
            color: #333;
        }

        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
            color: #4CAF50;
        }

        /* é¢æ¿æ ·å¼ */
        .panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .panel-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
        }

        .panel-title::before {
            content: "";
            width: 4px;
            height: 20px;
            background: #4CAF50;
            margin-right: 10px;
        }

        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .input-group input {
            flex: 1;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        /* åˆ—è¡¨æ ·å¼ */
        .list-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e0e0e0;
            transition: box-shadow 0.3s;
        }

        .list-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .alert-item {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .device-item {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        /* é¡µé¢åˆ‡æ¢ */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }

            .sidebar-header h2 {
                font-size: 0;
            }

            .menu-item span {
                display: none;
            }

            .sidebar-footer {
                padding: 10px;
            }

            .logout-btn {
                font-size: 0;
            }

            .logout-btn::before {
                content: "ğŸšª";
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <div class="login-title">ğŸ” ç®¡ç†åå°ç™»å½•</div>
            <input type="text" id="username" class="login-input" placeholder="ç”¨æˆ·å" value="admin">
            <input type="password" id="password" class="login-input" placeholder="å¯†ç " value="admin123">
            <button class="login-btn" onclick="login()">ç™»å½•</button>
        </div>
    </div>

    <!-- ç®¡ç†åå° -->
    <div class="admin-container" id="adminContainer">
        <div class="admin-layout">
            <!-- ä¾§è¾¹å¯¼èˆªæ  -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <h2>ğŸ” å…³é”®è¯ç›‘æ§</h2>
                </div>
                <div class="sidebar-menu">
                    <div class="menu-item active" onclick="switchPage('dashboard')">
                        <span class="menu-item-icon">ğŸ“Š</span>
                        <span>æ§åˆ¶å°</span>
                    </div>
                    <div class="menu-item" onclick="switchPage('keywords')">
                        <span class="menu-item-icon">âš™ï¸</span>
                        <span>å…³é”®è¯ç®¡ç†</span>
                    </div>
                    <div class="menu-item" onclick="switchPage('alerts')">
                        <span class="menu-item-icon">âš ï¸</span>
                        <span>è­¦å‘Šé€šçŸ¥</span>
                    </div>
                    <div class="menu-item" onclick="switchPage('devices')">
                        <span class="menu-item-icon">ğŸ“±</span>
                        <span>è®¾å¤‡ç®¡ç†</span>
                    </div>
                    <div class="menu-item" onclick="switchPage('telegram')">
                        <span class="menu-item-icon">ğŸ“²</span>
                        <span>Telegramé…ç½®</span>
                    </div>
                    <div class="menu-item" onclick="switchPage('app-password')">
                        <span class="menu-item-icon">ğŸ”</span>
                        <span>APPå¯†ç è®¾ç½®</span>
                    </div>
                </div>
                <div class="sidebar-footer">
                    <button class="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
                </div>
            </div>

            <!-- ä¸»å†…å®¹åŒºåŸŸ -->
            <div class="main-content">
                <div class="content-header">
                    <h1 id="pageTitle">æ§åˆ¶å°</h1>
                    <div style="color: #666; font-size: 14px;">
                        ğŸ‘¤ ç®¡ç†å‘˜
                    </div>
                </div>

                <div class="content-body">
                    <!-- æ§åˆ¶å°é¡µé¢ -->
                    <div id="page-dashboard" class="page-content active">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h3>ç›‘æ§å…³é”®è¯</h3>
                                <div class="number" id="keywordCount">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>æ€»è­¦å‘Šæ•°</h3>
                                <div class="number" id="alertCount">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>åœ¨çº¿è®¾å¤‡</h3>
                                <div class="number" id="deviceCount">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>ä»Šæ—¥è­¦å‘Š</h3>
                                <div class="number" id="todayCount">0</div>
                            </div>
                        </div>

                        <div class="panel">
                            <div class="panel-title">æœ€è¿‘è­¦å‘Š</div>
                            <div id="recentAlerts"></div>
                        </div>

                        <div class="panel">
                            <div class="panel-title">åœ¨çº¿è®¾å¤‡</div>
                            <div id="recentDevices"></div>
                        </div>
                    </div>

                    <!-- å…³é”®è¯ç®¡ç†é¡µé¢ -->
                    <div id="page-keywords" class="page-content">
                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">â• æ·»åŠ æ–°å…³é”®è¯</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">å…³é”®è¯ï¼ˆå¿…å¡«ï¼‰</label>
                                <input type="text" id="keywordInput" placeholder="ä¾‹å¦‚ï¼šæµ‹è¯•ã€ä½ å¥½ã€è¿ç¦è¯ç­‰" style="font-size: 16px; padding: 15px;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">åŒ¹é…ç±»å‹</label>
                                <select id="matchType" style="font-size: 16px; padding: 15px;">
                                    <option value="partial">æ¨¡ç³ŠåŒ¹é…ï¼ˆæ¨èï¼‰- æ–‡æ®µä¸­åŒ…å«å…³é”®è¯å°±è§¦å‘</option>
                                    <option value="exact">å®Œå…¨åŒ¹é… - å¿…é¡»å®Œå…¨ç›¸åŒæ‰è§¦å‘</option>
                                </select>
                            </div>
                            <button class="btn-primary" onclick="addKeyword()" style="font-size: 16px; padding: 15px 30px; width: 200px;">
                                â• æ·»åŠ å…³é”®è¯
                            </button>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">ğŸ“‹ å·²æ·»åŠ çš„å…³é”®è¯</div>
                                <div style="color: #666; font-size: 14px;">
                                    å…± <span id="keywordTotal">0</span> ä¸ª
                                </div>
                            </div>
                            <div id="keywordList"></div>
                        </div>
                    </div>

                    <!-- è­¦å‘Šé€šçŸ¥é¡µé¢ -->
                    <div id="page-alerts" class="page-content">
                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">è­¦å‘Šåˆ—è¡¨</div>
                                <div>
                                    <button class="btn-secondary" onclick="loadAlerts()">ğŸ”„ åˆ·æ–°</button>
                                    <button class="btn-danger" onclick="clearAlerts()">ğŸ—‘ï¸ æ¸…ç©º</button>
                                </div>
                            </div>
                            <div id="alertList"></div>
                        </div>
                    </div>

                    <!-- è®¾å¤‡ç®¡ç†é¡µé¢ -->
                    <div id="page-devices" class="page-content">
                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">ğŸ“± å·²è¿æ¥è®¾å¤‡</div>
                                <div>
                                    <button class="btn-secondary" onclick="loadDevices()">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
                                </div>
                            </div>
                            <div style="background: #fff3cd; padding: 15px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
                                <strong>ğŸ’¡ æç¤ºï¼š</strong> ç‚¹å‡»åˆ é™¤æŒ‰é’®å¯ä»¥ç§»é™¤è®¾å¤‡ï¼Œè®¾å¤‡ä¼šåœ¨ä¸‹æ¬¡è¿æ¥æ—¶é‡æ–°æ˜¾ç¤ºã€‚
                            </div>
                            <div id="deviceList"></div>
                        </div>
                    </div>

                    <!-- Telegramé…ç½®é¡µé¢ -->
                    <div id="page-telegram" class="page-content">
                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">ğŸ¤– æœºå™¨äººé…ç½®</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Bot Token</label>
                                <input type="text" id="botToken" placeholder="è¯·è¾“å…¥Bot Token">
                            </div>
                            <div style="margin-top: 15px;">
                                <button class="btn-primary" onclick="saveTelegramConfig()">ğŸ’¾ ä¿å­˜Bot Token</button>
                                <button class="btn-secondary" onclick="testTelegram()">ğŸ§ª æµ‹è¯•æ‰€æœ‰ç¾¤ç»„</button>
                            </div>
                        </div>

                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">ğŸ“¢ é€šçŸ¥ç¾¤ç»„ç®¡ç†</div>
                            </div>
                            <div style="background: #e3f2fd; padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #2196F3;">
                                <strong>ğŸ’¡ è¯´æ˜ï¼š</strong> å¯ä»¥æ·»åŠ å¤šä¸ªç¾¤ç»„ï¼Œå…³é”®è¯è§¦å‘æ—¶ä¼šå‘æ‰€æœ‰ç¾¤ç»„å‘é€é€šçŸ¥ã€‚
                            </div>
                            
                            <!-- æ·»åŠ ç¾¤ç»„è¡¨å• -->
                            <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <label class="form-label">ç¾¤ç»„åç§°ï¼ˆå¯é€‰ï¼‰</label>
                                    <input type="text" id="newGroupName" placeholder="ä¾‹å¦‚ï¼šç›‘æ§ç¾¤ç»„1" style="width: 100%;">
                                </div>
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <label class="form-label">Chat ID <span style="color: #f44336;">*</span></label>
                                    <input type="text" id="newChatId" placeholder="ä¾‹å¦‚ï¼š-1001234567890" style="width: 100%;">
                                </div>
                                <button class="btn-primary" onclick="addTelegramGroup()" style="width: 100%;">â• æ·»åŠ ç¾¤ç»„</button>
                            </div>

                            <!-- ç¾¤ç»„åˆ—è¡¨ -->
                            <div id="telegramGroupsList" style="margin-top: 20px;">
                                <div style="text-align: center; color: #999; padding: 20px;">åŠ è½½ä¸­...</div>
                            </div>
                        </div>

                        <div class="panel">
                            <div class="panel-title">ğŸ“– é…ç½®è¯´æ˜</div>
                            <div style="color: #666; line-height: 1.8;">
                                <p><strong>å¦‚ä½•è·å–Bot Tokenå’ŒChat IDï¼š</strong></p>
                                <ol style="margin-left: 20px; margin-top: 10px;">
                                    <li>æ‰“å¼€Telegramï¼Œæœç´¢ @BotFather</li>
                                    <li>å‘é€ /newbot åˆ›å»ºæœºå™¨äºº</li>
                                    <li>æŒ‰æç¤ºè®¾ç½®æœºå™¨äººåç§°å’Œç”¨æˆ·å</li>
                                    <li>è·å¾—Bot Tokenï¼Œå¡«å…¥ä¸Šæ–¹"Bot Token"</li>
                                    <li>åˆ›å»ºç¾¤ç»„ï¼Œå°†æœºå™¨äººåŠ å…¥ç¾¤ç»„å¹¶è®¾ä¸ºç®¡ç†å‘˜</li>
                                    <li>åœ¨ç¾¤ç»„å‘é€ä¸€æ¡æ¶ˆæ¯</li>
                                    <li>è®¿é—®: <code>https://api.telegram.org/botä½ çš„TOKEN/getUpdates</code></li>
                                    <li>æ‰¾åˆ° <code>"chat":{"id": -1001234567890}</code></li>
                                    <li>è¿™ä¸ªå°±æ˜¯Chat IDï¼Œå¡«å…¥ä¸Šæ–¹"Chat ID"å¹¶æ·»åŠ ç¾¤ç»„</li>
                                    <li><strong>å¯ä»¥é‡å¤æ·»åŠ å¤šä¸ªç¾¤ç»„ï¼Œæ¯ä¸ªç¾¤ç»„éƒ½ä¼šæ”¶åˆ°é€šçŸ¥</strong></li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <!-- APPå¯†ç è®¾ç½®é¡µé¢ -->
                    <div id="page-app-password" class="page-content">
                        <div class="panel">
                            <div class="panel-header">
                                <div class="panel-title">ğŸ” APPå¯†ç è®¾ç½®</div>
                            </div>
                            <div style="background: #e3f2fd; padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #2196F3;">
                                <strong>ğŸ“± è¯´æ˜ï¼š</strong> ç”¨æˆ·ä¸‹è½½APPåéœ€è¦è¾“å…¥æ­¤å¯†ç æ‰èƒ½ä½¿ç”¨ã€‚å¯†ç è‡³å°‘4ä½å­—ç¬¦ã€‚
                            </div>
                            <div class="form-group">
                                <label class="form-label">å½“å‰å¯†ç </label>
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <input type="text" id="currentPassword" readonly style="flex: 1; background: #f5f5f5;">
                                    <span id="passwordStatus" style="color: #999;">æœªè®¾ç½®</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">æ–°å¯†ç ï¼ˆå¿…å¡«ï¼‰</label>
                                <input type="text" id="newPassword" placeholder="è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘4ä½ï¼‰">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ç¡®è®¤å¯†ç </label>
                                <input type="text" id="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                            </div>
                            <div style="margin-top: 15px;">
                                <button class="btn-primary" onclick="saveAppPassword()">ğŸ’¾ ä¿å­˜å¯†ç </button>
                                <button class="btn-secondary" onclick="loadAppPassword()">ğŸ”„ åˆ·æ–°</button>
                            </div>
                        </div>

                        <div class="panel">
                            <div class="panel-title">â“ ä½¿ç”¨è¯´æ˜</div>
                            <div style="color: #666; line-height: 1.8;">
                                <ol style="margin-left: 20px; margin-top: 10px;">
                                    <li><strong>è®¾ç½®å¯†ç ï¼š</strong> åœ¨ä¸Šæ–¹è¾“å…¥æ–°å¯†ç å¹¶ä¿å­˜</li>
                                    <li><strong>APPéªŒè¯ï¼š</strong> ç”¨æˆ·æ‰“å¼€APPåä¼šè¦æ±‚è¾“å…¥æ­¤å¯†ç </li>
                                    <li><strong>å¯†ç æ­£ç¡®ï¼š</strong> æ‰èƒ½è¿›å…¥è®¾å¤‡å¤‡æ³¨å’Œæƒé™è®¾ç½®</li>
                                    <li><strong>ä¿®æ”¹å¯†ç ï¼š</strong> éšæ—¶å¯ä»¥åœ¨æ­¤ä¿®æ”¹ï¼Œæ—§ç”¨æˆ·ä¸å—å½±å“</li>
                                    <li><strong>å®‰å…¨å»ºè®®ï¼š</strong> å®šæœŸæ›´æ¢å¯†ç ï¼Œé¿å…ä½¿ç”¨ç®€å•å¯†ç </li>
                                </ol>
                                <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">
                                    <strong>âš ï¸ æ³¨æ„ï¼š</strong>
                                    <ul style="margin-left: 20px; margin-top: 10px;">
                                        <li>å·²éªŒè¯è¿‡å¯†ç çš„è®¾å¤‡ä¸éœ€è¦é‡æ–°éªŒè¯</li>
                                        <li>å¦‚æœç”¨æˆ·è¾“å…¥é”™è¯¯å¯†ç ï¼Œä¼šè¦æ±‚é‡æ–°è¾“å…¥</li>
                                        <li>å¯†ç å­˜å‚¨åœ¨æœåŠ¡å™¨ï¼Œæ‰€æœ‰æ–°å®‰è£…çš„APPéƒ½ä½¿ç”¨åŒä¸€ä¸ªå¯†ç </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '';

        // ç™»å½•åŠŸèƒ½
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === 'admin' && password === 'admin123') {
                localStorage.setItem('isLoggedIn', 'true');
                showAdmin();
            } else {
                alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼');
            }
        }

        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                localStorage.removeItem('isLoggedIn');
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('adminContainer').style.display = 'none';
        }

        function showAdmin() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'block';
            loadAllData();
        }

        // é¡µé¢åˆ‡æ¢
        function switchPage(pageName) {
            // æ›´æ–°å¯¼èˆªèœå•
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.menu-item').classList.add('active');

            // æ›´æ–°é¡µé¢æ ‡é¢˜
            const titles = {
                'dashboard': 'æ§åˆ¶å°',
                'keywords': 'å…³é”®è¯ç®¡ç†',
                'alerts': 'è­¦å‘Šé€šçŸ¥',
                'devices': 'è®¾å¤‡ç®¡ç†',
                'telegram': 'Telegramé…ç½®',
                'app-password': 'APPå¯†ç è®¾ç½®'
            };
            document.getElementById('pageTitle').textContent = titles[pageName];

            // åˆ‡æ¢å†…å®¹
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById('page-' + pageName).classList.add('active');

            // åŠ è½½å¯¹åº”é¡µé¢æ•°æ®
            if (pageName === 'keywords') loadKeywords();
            if (pageName === 'alerts') loadAlerts();
            if (pageName === 'devices') loadDevices();
            if (pageName === 'telegram') loadTelegramConfig();
            if (pageName === 'app-password') loadAppPassword();
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        window.onload = function() {
            if (localStorage.getItem('isLoggedIn') === 'true') {
                showAdmin();
            } else {
                showLogin();
            }
        };

        function loadAllData() {
            loadStats();
            loadRecentAlerts();
            loadRecentDevices();
        }

        // åŠ è½½ç»Ÿè®¡æ•°æ®
        async function loadStats() {
            const keywords = await fetch(`${API_BASE}/api/keywords`).then(r => r.json());
            const alerts = await fetch(`${API_BASE}/api/alerts`).then(r => r.json());
            const devices = await fetch(`${API_BASE}/api/devices`).then(r => r.json());
            
            document.getElementById('keywordCount').textContent = keywords.data.length;
            document.getElementById('alertCount').textContent = alerts.data.length;
            document.getElementById('deviceCount').textContent = devices.data.length;
            
            const today = new Date().toDateString();
            const todayAlerts = alerts.data.filter(alert => 
                new Date(alert.created_at).toDateString() === today
            );
            document.getElementById('todayCount').textContent = todayAlerts.length;
        }

        // åŠ è½½æœ€è¿‘è­¦å‘Šï¼ˆæ§åˆ¶å°ï¼‰
        async function loadRecentAlerts() {
            const response = await fetch(`${API_BASE}/api/alerts`);
            const data = await response.json();
            
            const list = document.getElementById('recentAlerts');
            if (data.data.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><div>æš‚æ— è­¦å‘Š</div></div>';
                return;
            }

            const recent = data.data.slice(0, 5);
            list.innerHTML = recent.map(alert => `
                <div class="list-item alert-item">
                    <div>
                        <div><strong>ğŸ“± ${alert.device_name}</strong> - è§¦å‘å…³é”®è¯: <strong>${alert.keyword}</strong></div>
                        <div style="color: #666; font-size: 13px; margin-top: 5px;">${alert.device_time || alert.created_at}</div>
                    </div>
                </div>
            `).join('');
        }

        // åŠ è½½æœ€è¿‘è®¾å¤‡ï¼ˆæ§åˆ¶å°ï¼‰
        async function loadRecentDevices() {
            const response = await fetch(`${API_BASE}/api/devices`);
            const data = await response.json();
            
            const list = document.getElementById('recentDevices');
            if (data.data.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“µ</div><div>æš‚æ— è®¾å¤‡</div></div>';
                return;
            }

            list.innerHTML = data.data.map(device => `
                <div class="list-item device-item">
                    <div>
                        <div><strong>ğŸ“± ${device.device_name}</strong></div>
                        <div style="color: #666; font-size: 13px;">æœ€ååœ¨çº¿: ${device.last_online}</div>
                    </div>
                </div>
            `).join('');
        }

        // æ·»åŠ å…³é”®è¯
        async function addKeyword() {
            const keyword = document.getElementById('keywordInput').value.trim();
            const matchType = document.getElementById('matchType').value;
            
            if (!keyword) {
                alert('è¯·è¾“å…¥å…³é”®è¯');
                return;
            }

            const response = await fetch(`${API_BASE}/api/keywords`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ keyword, match_type: matchType })
            });

            if (response.ok) {
                document.getElementById('keywordInput').value = '';
                loadKeywords();
                loadStats();
            }
        }

        // åŠ è½½å…³é”®è¯
        async function loadKeywords() {
            const response = await fetch(`${API_BASE}/api/keywords`);
            const data = await response.json();
            
            // æ›´æ–°è®¡æ•°
            const totalElement = document.getElementById('keywordTotal');
            if (totalElement) {
                totalElement.textContent = data.data.length;
            }
            
            const list = document.getElementById('keywordList');
            if (data.data.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“</div><div>æš‚æ— å…³é”®è¯ï¼Œè¯·åœ¨ä¸Šæ–¹æ·»åŠ </div></div>';
                return;
            }

            list.innerHTML = data.data.map(item => `
                <div class="list-item" style="padding: 20px;">
                    <div>
                        <div style="font-size: 18px; margin-bottom: 5px;"><strong>ğŸ”‘ ${item.keyword}</strong></div>
                        <div style="color: #666; font-size: 14px;">åŒ¹é…ç±»å‹: ${item.match_type === 'exact' ? 'å®Œå…¨åŒ¹é…' : 'æ¨¡ç³ŠåŒ¹é…'}</div>
                    </div>
                    <button class="btn-danger" onclick="deleteKeywordConfirm('${item.id}', '${item.keyword}')" style="padding: 10px 20px;">
                        ğŸ—‘ï¸ åˆ é™¤
                    </button>
                </div>
            `).join('');
        }

        // åˆ é™¤å…³é”®è¯ç¡®è®¤
        function deleteKeywordConfirm(id, keyword) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤å…³é”®è¯ "${keyword}" å—ï¼Ÿ\n\nåˆ é™¤åå°†ä¸å†ç›‘æ§æ­¤å…³é”®è¯ã€‚`)) {
                deleteKeyword(id);
            }
        }

        // åˆ é™¤å…³é”®è¯
        async function deleteKeyword(id) {
            if (!confirm('ç¡®å®šåˆ é™¤æ­¤å…³é”®è¯ï¼Ÿ')) return;
            
            await fetch(`${API_BASE}/api/keywords/${id}`, { method: 'DELETE' });
            loadKeywords();
            loadStats();
        }

        // åŠ è½½è­¦å‘Š
        async function loadAlerts() {
            const response = await fetch(`${API_BASE}/api/alerts`);
            const data = await response.json();
            
            const list = document.getElementById('alertList');
            if (data.data.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><div>æš‚æ— è­¦å‘Š</div></div>';
                return;
            }

            list.innerHTML = data.data.map(alert => `
                <div class="list-item alert-item">
                    <div style="flex: 1;">
                        <div><strong>ğŸ“± è®¾å¤‡:</strong> ${alert.device_name}</div>
                        <div><strong>ğŸ”´ å…³é”®è¯:</strong> ${alert.keyword}</div>
                        <div><strong>ğŸ’¬ æ–‡æœ¬:</strong> ${alert.triggered_text || 'æ— '}</div>
                        <div style="color: #666; margin-top: 5px;"><strong>â° æ—¶é—´:</strong> ${alert.device_time || alert.created_at}</div>
                    </div>
                </div>
            `).join('');
        }

        // æ¸…ç©ºè­¦å‘Š
        async function clearAlerts() {
            if (!confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰è­¦å‘Šè®°å½•ï¼Ÿ')) return;
            
            await fetch(`${API_BASE}/api/alerts`, { method: 'DELETE' });
            loadAlerts();
            loadStats();
        }

        // åŠ è½½è®¾å¤‡
        async function loadDevices() {
            const response = await fetch(`${API_BASE}/api/devices`);
            const data = await response.json();
            
            const list = document.getElementById('deviceList');
            if (data.data.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“µ</div><div>æš‚æ— è¿æ¥è®¾å¤‡<br><small style="color: #999;">æ‰‹æœºå®‰è£…APPå¹¶å¯ç”¨åä¼šè‡ªåŠ¨æ˜¾ç¤º</small></div></div>';
                return;
            }

            list.innerHTML = data.data.map(device => `
                <div class="list-item device-item" style="padding: 20px;">
                    <div>
                        <div style="font-size: 18px; margin-bottom: 5px;"><strong>ğŸ“± ${device.device_name}</strong></div>
                        <div style="color: #666; font-size: 14px;">
                            <div>è®¾å¤‡ID: ${device.id.substring(0, 12)}...</div>
                            <div>æœ€ååœ¨çº¿: ${device.last_online}</div>
                        </div>
                    </div>
                    <button class="btn-danger" onclick="deleteDeviceConfirm('${device.id}', '${device.device_name}')" style="padding: 10px 20px;">
                        ğŸ—‘ï¸ åˆ é™¤è®¾å¤‡
                    </button>
                </div>
            `).join('');
        }

        // åˆ é™¤è®¾å¤‡ç¡®è®¤
        function deleteDeviceConfirm(id, name) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤è®¾å¤‡ "${name}" å—ï¼Ÿ\n\nåˆ é™¤åè¯¥è®¾å¤‡ä¸‹æ¬¡è¿æ¥æ—¶ä¼šé‡æ–°å‡ºç°ã€‚`)) {
                deleteDevice(id);
            }
        }

        // åˆ é™¤è®¾å¤‡
        async function deleteDevice(id) {
            try {
                const response = await fetch(`${API_BASE}/api/devices/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    alert('âœ… è®¾å¤‡å·²åˆ é™¤ï¼');
                    loadDevices();
                    loadStats();
                } else {
                    alert('âŒ åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            } catch (error) {
                alert('âŒ åˆ é™¤å¤±è´¥ï¼š' + error.message);
            }
        }

        // åŠ è½½Telegramé…ç½®
        async function loadTelegramConfig() {
            try {
                // åŠ è½½Bot Token
                const configResponse = await fetch(`${API_BASE}/api/telegram/config`);
                const configData = await configResponse.json();
                
                if (configData.success) {
                    document.getElementById('botToken').value = configData.data.token || '';
                }
                
                // åŠ è½½ç¾¤ç»„åˆ—è¡¨
                await loadTelegramGroups();
            } catch (error) {
                console.error('åŠ è½½Telegramé…ç½®å¤±è´¥:', error);
            }
        }

        // åŠ è½½ç¾¤ç»„åˆ—è¡¨
        async function loadTelegramGroups() {
            try {
                const response = await fetch(`${API_BASE}/api/telegram/groups`);
                const data = await response.json();
                
                const groupsList = document.getElementById('telegramGroupsList');
                
                if (data.success && data.data && data.data.length > 0) {
                    groupsList.innerHTML = data.data.map(group => `
                        <div style="background: #fff; border: 1px solid #e0e0e0; border-radius: 6px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold; margin-bottom: 5px;">${group.group_name || 'æœªå‘½åç¾¤ç»„'}</div>
                                <div style="color: #666; font-size: 13px;">Chat ID: <code>${group.chat_id}</code></div>
                                <div style="color: #999; font-size: 12px; margin-top: 5px;">æ·»åŠ æ—¶é—´: ${new Date(group.created_at).toLocaleString('zh-CN')}</div>
                            </div>
                            <button class="btn-danger" onclick="deleteTelegramGroup('${group.id}', '${(group.group_name || 'æœªå‘½åç¾¤ç»„').replace(/'/g, "\\'")}')" style="padding: 8px 15px;">ğŸ—‘ï¸ åˆ é™¤</button>
                        </div>
                    `).join('');
                } else {
                    groupsList.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">æš‚æ— ç¾¤ç»„ï¼Œè¯·æ·»åŠ ç¬¬ä¸€ä¸ªç¾¤ç»„</div>';
                }
            } catch (error) {
                document.getElementById('telegramGroupsList').innerHTML = '<div style="text-align: center; color: #f44336; padding: 20px;">åŠ è½½å¤±è´¥ï¼š' + error.message + '</div>';
            }
        }

        // æ·»åŠ Telegramç¾¤ç»„
        async function addTelegramGroup() {
            const chatId = document.getElementById('newChatId').value.trim();
            const groupName = document.getElementById('newGroupName').value.trim();
            
            if (!chatId) {
                alert('è¯·è¾“å…¥Chat IDï¼');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/telegram/groups`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: chatId, group_name: groupName })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('âœ… ç¾¤ç»„å·²æ·»åŠ ï¼');
                    document.getElementById('newChatId').value = '';
                    document.getElementById('newGroupName').value = '';
                    await loadTelegramGroups();
                } else {
                    alert('âŒ æ·»åŠ å¤±è´¥ï¼š' + data.error);
                }
            } catch (error) {
                alert('æ·»åŠ å¤±è´¥ï¼š' + error.message);
            }
        }

        // åˆ é™¤Telegramç¾¤ç»„
        async function deleteTelegramGroup(id, name) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤ç¾¤ç»„ "${name}" å—ï¼Ÿ\n\nåˆ é™¤åè¯¥ç¾¤ç»„å°†ä¸å†æ¥æ”¶é€šçŸ¥ã€‚`)) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/telegram/groups/${id}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('âœ… ç¾¤ç»„å·²åˆ é™¤ï¼');
                    await loadTelegramGroups();
                } else {
                    alert('âŒ åˆ é™¤å¤±è´¥ï¼š' + data.error);
                }
            } catch (error) {
                alert('åˆ é™¤å¤±è´¥ï¼š' + error.message);
            }
        }

        // åŠ è½½APPå¯†ç 
        async function loadAppPassword() {
            try {
                const response = await fetch(`${API_BASE}/api/app-password`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    const password = data.data.password;
                    document.getElementById('currentPassword').value = password || '';
                    document.getElementById('passwordStatus').textContent = password ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®';
                    document.getElementById('passwordStatus').style.color = password ? '#4CAF50' : '#999';
                }
            } catch (error) {
                alert('åŠ è½½å¯†ç å¤±è´¥ï¼š' + error.message);
            }
        }

        // ä¿å­˜APPå¯†ç 
        async function saveAppPassword() {
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            
            if (!newPassword) {
                alert('è¯·è¾“å…¥æ–°å¯†ç ï¼');
                return;
            }
            
            if (newPassword.length < 4) {
                alert('å¯†ç è‡³å°‘4ä½å­—ç¬¦ï¼');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/app-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: newPassword })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('âœ… APPå¯†ç è®¾ç½®æˆåŠŸï¼');
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                    loadAppPassword();
                } else {
                    alert('âŒ è®¾ç½®å¤±è´¥ï¼š' + data.error);
                }
            } catch (error) {
                alert('è®¾ç½®å¤±è´¥ï¼š' + error.message);
            }
        }

        // ä¿å­˜Telegramé…ç½®
        async function saveTelegramConfig() {
            const botToken = document.getElementById('botToken').value.trim();
            
            if (!botToken) {
                alert('è¯·è¾“å…¥Bot Tokenï¼');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/telegram/config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token: botToken })
                });
                
                const data = await response.json();
                if (data.success) {
                    alert('âœ… Bot Tokenå·²ä¿å­˜ï¼');
                } else {
                    alert('âŒ ä¿å­˜å¤±è´¥ï¼š' + data.error);
                }
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
            }
        }

        // æµ‹è¯•Telegramï¼ˆå‘æ‰€æœ‰ç¾¤ç»„å‘é€ï¼‰
        async function testTelegram() {
            try {
                const response = await fetch(`${API_BASE}/api/telegram/test`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                if (data.success) {
                    alert(`âœ… ${data.message}\n\nè¯·æ£€æŸ¥æ‰€æœ‰Telegramç¾¤ç»„æ˜¯å¦æ”¶åˆ°æµ‹è¯•æ¶ˆæ¯ã€‚`);
                } else {
                    alert('âŒ å‘é€å¤±è´¥ï¼š' + data.error);
                }
            } catch (error) {
                alert('æµ‹è¯•å¤±è´¥ï¼š' + error.message);
            }
        }

        // å®šæ—¶åˆ·æ–°ï¼ˆä»…åœ¨æ§åˆ¶å°é¡µé¢ï¼‰
        setInterval(() => {
            if (document.getElementById('page-dashboard').classList.contains('active')) {
                loadAllData();
            }
        }, 5000);
    </script>
</body>
</html>
