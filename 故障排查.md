# 🔧 关键词监控系统 - 故障排查指南

## 问题：手机输入关键词后，管理后台没有警告

### 快速检查清单

- [ ] 后端服务是否运行
- [ ] 手机辅助功能是否开启
- [ ] APP是否被系统杀死
- [ ] 电池优化是否限制了APP
- [ ] 网络连接是否正常
- [ ] 关键词是否正确添加

---

## 🔍 详细排查步骤

### 1️⃣ 检查服务器端（在服务器上执行）

```bash
# 检查后端进程
ps aux | grep "node.*server.js" | grep -v grep

# 如果没有输出，说明服务停了，重启：
cd /www/wwwroot/keyword-monitor
./start.sh

# 测试API
curl http://localhost:3000/api/stats

# 查看关键词列表
curl http://localhost:3000/api/keywords

# 查看设备列表
curl http://localhost:3000/api/devices
```

### 2️⃣ 检查手机端APP

#### A. 辅助功能状态

**症状**：服务被系统自动关闭

**检查方法**：
1. 打开"关键词监控"APP
2. 查看状态显示：
   - ✅ 正常：`服务状态: 🟢 运行中`
   - ❌ 异常：`服务状态: 🔴 未运行`

**解决方法**：
1. 设置 → 辅助功能 → 关键词监控
2. 确保开关是开启状态
3. 如果被关闭，重新打开

#### B. 电池优化限制

**症状**：APP被系统后台杀死

**小米/红米手机**：
```
设置 → 应用设置 → 应用管理 → 关键词监控
- 省电策略：选择"无限制"
- 自启动：开启
- 后台弹出界面：允许
```

**华为/荣耀手机**：
```
设置 → 应用 → 应用启动管理 → 关键词监控
- 关闭"自动管理"
- 手动设置：
  ✅ 自启动
  ✅ 关联启动
  ✅ 后台活动
```

**OPPO/一加/真我手机**：
```
设置 → 电池 → 应用耗电管理 → 关键词监控
- 选择"不限制"或"允许后台运行"
```

**vivo手机**：
```
设置 → 电池 → 后台高耗电 → 关键词监控
- 允许后台运行
```

**三星手机**：
```
设置 → 应用程序 → 关键词监控 → 电池
- 选择"不受限"
```

#### C. 通知权限

虽然不影响功能，但最好也允许：
```
设置 → 应用 → 关键词监控 → 通知
- 允许通知
```

### 3️⃣ 检查网络连接

**在手机APP中检查**：
- 状态栏应显示：`🔌 服务器地址: 已设置`
- 如果显示"未设置"，重新输入：`http://38.49.29.167:3000`

**测试网络连通性**：
1. 用手机浏览器访问：`http://38.49.29.167:3000`
2. 应该能看到管理后台界面
3. 如果无法访问，检查：
   - 手机是否能上网（WiFi/4G/5G）
   - 服务器防火墙是否开放3000端口

### 4️⃣ 检查关键词设置

**常见错误**：
- ❌ 关键词拼写错误
- ❌ 关键词大小写不匹配（系统默认不区分大小写）
- ❌ 关键词包含特殊字符

**正确方式**：
- ✅ 使用简单的中文或英文
- ✅ 避免特殊符号
- ✅ 一个关键词一行

---

## 🧪 测试步骤

完成上述检查后，按以下步骤测试：

### 测试1：基础功能测试

1. 在管理后台添加关键词：`测试123`
2. 打开手机微信或记事本
3. 输入：`这是一个测试123的文本`
4. 等待2-3秒
5. 刷新管理后台，查看警告通知

### 测试2：实时性测试

1. 打开管理后台，停留在页面上
2. 在手机输入关键词
3. 观察警告通知是否在5秒内出现

### 测试3：多关键词测试

1. 添加多个关键词：`密码`、`账号`、`银行卡`
2. 在手机输入：`我的密码是123456，账号是test`
3. 应该触发2次警告（密码、账号各一次）

---

## 📊 查看日志

### 服务器端日志

```bash
# 查看实时日志
tail -f /tmp/keyword-monitor.log

# 查看最近的日志
tail -100 /tmp/keyword-monitor.log
```

### 手机端日志（需要电脑+ADB）

```bash
# 连接手机后
adb logcat | grep "KeywordMonitor"
```

---

## 🔄 完全重置

如果以上都不行，尝试完全重置：

### 手机端

1. **卸载APP**
2. **重启手机**
3. **重新安装APP**：下载 `http://38.49.29.167:3000/关键词监控.apk`
4. **重新配置**：
   - 输入服务器地址
   - 启用辅助功能
   - 设置电池优化白名单

### 服务器端

```bash
# 停止服务
cd /www/wwwroot/keyword-monitor
./stop.sh

# 清空数据库（可选，会删除所有数据）
rm /www/wwwroot/keyword-monitor/backend/monitor.db

# 重新启动
./start.sh
```

---

## 🆘 常见问题

### Q1: 为什么之前能用，现在不能用了？

**A**: 常见原因：
1. 手机系统更新后，辅助功能被自动关闭
2. 清理软件误杀了后台服务
3. 省电模式自动限制了APP
4. 系统安全策略变更

### Q2: 手机重启后需要重新设置吗？

**A**: 不需要，但需要确保：
1. 辅助功能自启动权限已开启
2. APP在电池优化白名单中
3. 开机后手动打开一次APP确认状态

### Q3: 为什么有时候会延迟？

**A**: 正常现象，原因：
1. 网络延迟（1-2秒正常）
2. 手机后台限制导致服务响应慢
3. 服务器负载高（一般不会）

### Q4: 能监控所有输入吗？

**A**: 大部分可以，但有限制：
- ✅ 可以：微信、QQ、记事本、浏览器、各种输入框
- ❌ 不能：密码输入框（系统安全限制）、某些加密输入（如银行APP）

### Q5: 如何更新关键词？

**A**: 管理后台直接添加即可，无需重启手机或APP

---

## 📞 还是不行？

提供以下信息便于诊断：

1. **手机型号和系统版本**
2. **APP状态截图**（主界面状态显示）
3. **辅助功能设置截图**
4. **服务器端统计信息**：
   ```bash
   curl http://localhost:3000/api/stats
   curl http://localhost:3000/api/devices
   ```
5. **具体操作步骤**和**预期结果 vs 实际结果**

---

## ✅ 预防措施

为了避免问题再次出现：

1. **锁定APP在后台**（如果手机支持）
2. **将APP加入省电白名单**
3. **定期检查辅助功能状态**
4. **避免使用清理工具清理APP**
5. **手机重启后检查一次状态**

---

**最后更新**: 2025-11-06








